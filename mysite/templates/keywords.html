
<html>
<!-- this page includes the top level menu bar and the background img for all pages  -->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		
        <title>Social Media Analytics</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
		
		<!-- css -->
		<!-- bootstrap css -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">
        <link rel="stylesheet" href="/static/css/bootstrap-theme.min.css?v=00001"  type="text/css">
		<link rel="stylesheet" href="/static/css/bootstrap-social.css?v=00001" type="text/css">
		<link rel="stylesheet" href="/static/css/vendor.min.css?v=00001" type="text/css">
		<!-- other css -->
        <!-- <link rel="stylesheet" href="/static/css/fontAwesome.css?v=00001" type="text/css"> -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
		<link rel="stylesheet" href="/static/css/bootstrap-combobox.css?v=00001" type="text/css">
        <!-- <link rel="stylesheet" href="/static/css/hero-slider.css?v=00001" type="text/css"> -->
        <link rel="stylesheet" href="/static/css/owl-carousel.css?v=00001" type="text/css">
		<link rel="stylesheet" href="/static/css/lightbox.css?v=00001" type="text/css">
		<link rel="stylesheet" href="/static/css/flexslider.css?v=00001" type="text/css" media="screen" />
		<!-- our css -->
        <link rel="stylesheet" href="/static/css/templatemo-style.css?v=00001" type="text/css">
		<link rel="stylesheet" href="/static/css/templatemo_style.css?v=00001" type="text/css">
		<link rel="stylesheet" href="/static/css/project.css?v=00001" type="text/css">
		
		<!-- js -->
		<script src="/static/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
		<script src="https://connect.facebook.net/en_US/all.js"></script>

		<!-- D3.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    </head>

<body>

	<div class="header">
        <div class="container">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href=/socialtracker/ class="navbar-brand"><em>S-</em>analysis</a>
                </div>
                <!--/.navbar-header-->
                <div id="main-nav" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a class="scroll-top" href=/socialtracker/>Home</a></li>
                        <li><a class="scroll-link" data-id="contact-us">Contact Us</a></li>
						
							<li>
								<a class="scroll-link" href=/socialtracker/account>My Account</a>
							</li>
							<li>
							<a class="scroll-link" href=/socialtracker/data>My Analysis</a>
							</li>
							<li>
								<a class="scroll-link" href=/socialtracker/twitter_logout>Log out</a>
							</li>
						
                    </ul>
                </div>
                <!--/.navbar-collapse-->
            </nav>
            <!--/.navbar-->
        </div>
        <!--/.container-->
    </div>
    <!--/.header-->
	
	<div class="parallax-content baner-content" id="home" style="height:1000px;">
        
<style>
#chart {
	font-family: 'Merriweather Sans', sans-serif;
	font-size: 10px;
	font-weight: 400;
	color: #4c4c4c;
	fill: #4c4c4c;
	text-align: center;
	cursor: default;
}

a,
a:hover {
	color: #333333;
}

.title {
	font-family: 'Oswald', sans-serif;
	color: #1c1c1c;
	text-align: left;
}

#topTitle {
	font-size: 36px;
	line-height: 1.2;
}

#subTitle {
	text-align: left;
	margin-bottom: 20px;
	font-size: 16px;
	color: #BFBFBF;
	font-family: 'Oswald', sans-serif;
	font-weight: 300;
}

#topText{
	text-align: left;
	font-family: 'Merriweather Sans', sans-serif;
	font-size: 11px;
	/*margin-bottom: 10px;*/
	line-height: 1.5;
	color: #7D7D7D;
}

#searchTitle {
	font-size: 20px;
	margin-bottom: 10px;
}

.form-control {
	font-size: 11px;
	font-family: 'Merriweather Sans', sans-serif;
}

.dropdown-menu {
	font-size: 11px;
	font-family: 'Merriweather Sans', sans-serif;
}

.dropdown-menu>.active>a,
.dropdown-menu>.active>a:hover,
.dropdown-menu>.active>a:focus  {
	background-color: #7D7D7D;
}

#legendTitle {
	text-align: left;
	font-family: 'Oswald', sans-serif;
	margin-bottom: 5px;
	font-size: 13px;
	color: #1c1c1c;
}

#legendText {
	text-align: left;
	margin-bottom: 10px;
	font-size: 10px;
	line-height: 1.5;
	font-family: 'Merriweather Sans', sans-serif;
	color: #7D7D7D;
}

.legendCircle {
	stroke-width:1;
	stroke:#757575;
	stroke-dasharray:2 2;
	fill:none;
}

.legendLine {
	stroke-width: 1;
	stroke: #E0E0E0;
	shape-rendering: crispEdges;
}

.legendTitle {
	fill: #333333;
	font-family: 'Oswald', sans-serif;
	text-anchor: middle;
	font-size: 14px;
}

.legendSubTitle {
	color: #BFBFBF;
	text-anchor: middle;
	font-size: 10px;
	line-height: 1.2;
	font-family: 'Merriweather Sans', sans-serif;
}

.legendText {
	text-anchor: start;
	font-size: 9px;
}

#attribution {
	text-align: left;
	margin-bottom: 20px;
	margin-top: 10px;
	font-size: 12px;
	/*bottom: 0px;
	position: fixed;*/
	color: #bfbfbf;
	font-family: 'Merriweather Sans', sans-serif;
}

@media (min-width: 768px) {
	#loadText {
		font-size: 24px;
		top:40%;
	}
}

.nodeTooltip {
	color: #333333;
	font-family: 'Oswald', sans-serif;
	text-anchor: middle;
	font-size: 12px;
	text-align: center;
}

.popover{
	text-align: center;
	pointer-events: none;
}
</style>

<ul class="form" style="float:left; margin-top: 50px;">
	<li class="data-leftnav"><a class="data-leftnav-link" href="#">Personality</a></li>
	<li class="data-leftnav"><a class="data-leftnav-link" href="#">Tone Analysis</a></li>
	<li class="data-leftnav"><a class="data-leftnav-link" href="#">Words Use</a></li>
	<li class="data-leftnav"><a class="data-leftnav-link" href=/socialtracker/tone_analysis>Social Network</a></li>
	<li class="data-leftnav"><a class="data-leftnav-link" href="#">Life Pattern</a></li>
</ul>

<div class="row text-center" style="margin-top: 40px;">
	<div class="col-md-4">
		<!-- <div id="searchTitle" class="title">Find an Occupation</div> -->
		<div class="form-group">			
			<select id="searchBox" class="combobox input-large form-control" style="display: none;" onchange="searchEvent(this.value)">
				 <option value="" selected="selected">Search...</option>
			</select>
		</div>
	</div>
	
	<div class="col-md-8">
		<div id="chart"></div>
	</div>
</div>

<!-- vertical menu -->
<div class="col-lg-2" id="media-nav">
	
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="../static/js/bootstrap-combobox.js"></script>
<script type="text/javascript" src="../static/js/control.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
<script src="https://d3js.org/queue.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js"></script>
<!-- <script src="../static/js/multiCurves.js"></script> -->

<script>

var node_data = {'name': 'outermost', 'children': [{'name': 'positive', 'children': [{'name': 'night market', 'ID': '1.1.1', 'relevance': 97}, {'name': 'winter victoria night', 'ID': '1.1.2', 'relevance': 93}, {'name': 'good recommendation', 'ID': '1.1.3', 'relevance': 78}, {'name': 'real boost', 'ID': '1.1.4', 'relevance': 75}, {'name': 'cooking skills', 'ID': '1.1.5', 'relevance': 75}, {'name': 'Wonderland display', 'ID': '1.1.6', 'relevance': 74}, {'name': 'best thing', 'ID': '1.1.7', 'relevance': 74}, {'name': 'childhood dream', 'ID': '1.1.8', 'relevance': 73}, {'name': 'particular programming', 'ID': '1.1.9', 'relevance': 73}, {'name': 'good health', 'ID': '1.1.10', 'relevance': 73}, {'name': 'good skin', 'ID': '1.1.11', 'relevance': 73}, {'name': 'time machine', 'ID': '1.1.12', 'relevance': 72}, {'name': 'big data', 'ID': '1.1.13', 'relevance': 71}, {'name': 'craziness', 'ID': '1.1.14', 'relevance': 56}, {'name': 'ACMI', 'ID': '1.1.15', 'relevance': 56}, {'name': 'Melbourne', 'ID': '1.1.16', 'relevance': 54}, {'name': 'leaves', 'ID': '1.1.17', 'relevance': 54}, {'name': 'tutor', 'ID': '1.1.18', 'relevance': 54}]}, {'name': 'negative', 'children': [{'name': 'mood e… https://t.co/RvExvQq4IN', 'ID': '1.2.1', 'relevance': 99}, {'name': 'expensive skincare', 'ID': '1.2.8', 'relevance': 74}, {'name': 'good vibe', 'ID': '1.2.8', 'relevance': 74}, {'name': 'good place', 'ID': '1.2.10', 'relevance': 73}, {'name': 'hard subjects', 'ID': '1.2.12', 'relevance': 72}, {'name': 'life balance', 'ID': '1.2.12', 'relevance': 72}, {'name': 'fair mark', 'ID': '1.2.12', 'relevance': 72}, {'name': 'crazy projects', 'ID': '1.2.12', 'relevance': 72}, {'name': 'group project', 'ID': '1.2.12', 'relevance': 72}, {'name': 'm… https://t.co/OeUSdUXhaJ', 'ID': '1.2.13', 'relevance': 71}, {'name': 'visualization tools', 'ID': '1.2.13', 'relevance': 71}, {'name': 'api calls', 'ID': '1.2.14', 'relevance': 71}, {'name': 'big project', 'ID': '1.2.14', 'relevance': 71}, {'name': 'hard time', 'ID': '1.2.14', 'relevance': 71}, {'name': 'semester', 'ID': '1.2.14', 'relevance': 60}, {'name': 'campus', 'ID': '1.2.14', 'relevance': 58}, {'name': 'vacation', 'ID': '1.2.14', 'relevance': 57}, {'name': 'Homesickness', 'ID': '1.2.14', 'relevance': 57}, {'name': 'grudges', 'ID': '1.2.14', 'relevance': 56}, {'name': 'complains', 'ID': '1.2.16', 'relevance': 56}, {'name': 'FB', 'ID': '1.2.16', 'relevance': 55}, {'name': 'memes', 'ID': '1.2.16', 'relevance': 55}, {'name': 'slaves', 'ID': '1.2.16', 'relevance': 55}, {'name': 'nightmares', 'ID': '1.2.17', 'relevance': 54}, {'name': 'nightmare', 'ID': '1.2.17', 'relevance': 54}, {'name': 'Twitter', 'ID': '1.2.17', 'relevance': 54}, {'name': 'cats', 'ID': '1.2.17', 'relevance': 54}, {'name': 'relationship', 'ID': '1.2.18', 'relevance': 54}, {'name': 'Spider', 'ID': '1.2.18', 'relevance': 54}, {'name': 'family', 'ID': '1.2.18', 'relevance': 54}, {'name': 'University', 'ID': '1.2.18', 'relevance': 54}, {'name': 'hell', 'ID': '1.2.19', 'relevance': 54}]}]};
var id_by_name = {'mood e… https://t.co/RvExvQq4IN': '1.2.1', 'night market': '1.1.1', 'winter victoria night': '1.1.2', 'good recommendation': '1.1.3', 'real boost': '1.1.4', 'cooking skills': '1.1.5', 'Wonderland display': '1.1.6', 'best thing': '1.1.7', 'expensive skincare': '1.2.8', 'good vibe': '1.2.8', 'childhood dream': '1.1.8', 'particular programming': '1.1.9', 'good place': '1.2.10', 'good health': '1.1.10', 'good skin': '1.1.11', 'hard subjects': '1.2.12', 'life balance': '1.2.12', 'fair mark': '1.2.12', 'crazy projects': '1.2.12', 'group project': '1.2.12', 'time machine': '1.1.12', 'm… https://t.co/OeUSdUXhaJ': '1.2.13', 'visualization tools': '1.2.13', 'big data': '1.1.13', 'api calls': '1.2.14', 'big project': '1.2.14', 'hard time': '1.2.14', 'semester': '1.2.14', 'campus': '1.2.14', 'vacation': '1.2.14', 'Homesickness': '1.2.14', 'grudges': '1.2.14', 'craziness': '1.1.14', 'ACMI': '1.1.15', 'complains': '1.2.16', 'FB': '1.2.16', 'memes': '1.2.16', 'slaves': '1.2.16', 'Melbourne': '1.1.16', 'nightmares': '1.2.17', 'nightmare': '1.2.17', 'Twitter': '1.2.17', 'cats': '1.2.17', 'leaves': '1.1.17', 'relationship': '1.2.18', 'Spider': '1.2.18', 'family': '1.2.18', 'University': '1.2.18', 'tutor': '1.1.18', 'hell': '1.2.19'};
var data_with_values = {'1.2.1': {'key': '1.2.1', 'values': [{'ID': '1.2.1', 'emotion': 'sadness', 'value': 0.967512}, {'ID': '1.2.1', 'emotion': 'joy', 'value': 0.008777}, {'ID': '1.2.1', 'emotion': 'fear', 'value': 0.100405}, {'ID': '1.2.1', 'emotion': 'disgust', 'value': 0.037638}, {'ID': '1.2.1', 'emotion': 'anger', 'value': 0.054107}]}, '1.1.1': {'key': '1.1.1', 'values': [{'ID': '1.1.1', 'emotion': 'sadness', 'value': 0.105916}, {'ID': '1.1.1', 'emotion': 'joy', 'value': 0.81435}, {'ID': '1.1.1', 'emotion': 'fear', 'value': 0.027206}, {'ID': '1.1.1', 'emotion': 'disgust', 'value': 0.003654}, {'ID': '1.1.1', 'emotion': 'anger', 'value': 0.042361}]}, '1.1.2': {'key': '1.1.2', 'values': [{'ID': '1.1.2', 'emotion': 'sadness', 'value': 0.20057}, {'ID': '1.1.2', 'emotion': 'joy', 'value': 0.712142}, {'ID': '1.1.2', 'emotion': 'fear', 'value': 0.025089}, {'ID': '1.1.2', 'emotion': 'disgust', 'value': 0.009434}, {'ID': '1.1.2', 'emotion': 'anger', 'value': 0.040997}]}, '1.1.3': {'key': '1.1.3', 'values': [{'ID': '1.1.3', 'emotion': 'sadness', 'value': 0.098371}, {'ID': '1.1.3', 'emotion': 'joy', 'value': 0.726226}, {'ID': '1.1.3', 'emotion': 'fear', 'value': 0.03896}, {'ID': '1.1.3', 'emotion': 'disgust', 'value': 0.079797}, {'ID': '1.1.3', 'emotion': 'anger', 'value': 0.021642}]}, '1.1.4': {'key': '1.1.4', 'values': [{'ID': '1.1.4', 'emotion': 'sadness', 'value': 0.06202}, {'ID': '1.1.4', 'emotion': 'joy', 'value': 0.61364}, {'ID': '1.1.4', 'emotion': 'fear', 'value': 0.047367}, {'ID': '1.1.4', 'emotion': 'disgust', 'value': 0.022445}, {'ID': '1.1.4', 'emotion': 'anger', 'value': 0.112927}]}, '1.1.5': {'key': '1.1.5', 'values': [{'ID': '1.1.5', 'emotion': 'sadness', 'value': 0.06202}, {'ID': '1.1.5', 'emotion': 'joy', 'value': 0.61364}, {'ID': '1.1.5', 'emotion': 'fear', 'value': 0.047367}, {'ID': '1.1.5', 'emotion': 'disgust', 'value': 0.022445}, {'ID': '1.1.5', 'emotion': 'anger', 'value': 0.112927}]}, '1.1.6': {'key': '1.1.6', 'values': [{'ID': '1.1.6', 'emotion': 'sadness', 'value': 0.186308}, {'ID': '1.1.6', 'emotion': 'joy', 'value': 0.177555}, {'ID': '1.1.6', 'emotion': 'fear', 'value': 0.105614}, {'ID': '1.1.6', 'emotion': 'disgust', 'value': 0.157869}, {'ID': '1.1.6', 'emotion': 'anger', 'value': 0.101773}]}, '1.1.7': {'key': '1.1.7', 'values': [{'ID': '1.1.7', 'emotion': 'sadness', 'value': 0.032423}, {'ID': '1.1.7', 'emotion': 'joy', 'value': 0.595649}, {'ID': '1.1.7', 'emotion': 'fear', 'value': 0.02916}, {'ID': '1.1.7', 'emotion': 'disgust', 'value': 0.014823}, {'ID': '1.1.7', 'emotion': 'anger', 'value': 0.020314}]}, '1.2.8': {'key': '1.2.8', 'values': [{'ID': '1.2.8', 'emotion': 'sadness', 'value': 0.215322}, {'ID': '1.2.8', 'emotion': 'joy', 'value': 0.613089}, {'ID': '1.2.8', 'emotion': 'fear', 'value': 0.193998}, {'ID': '1.2.8', 'emotion': 'disgust', 'value': 0.021328}, {'ID': '1.2.8', 'emotion': 'anger', 'value': 0.01257}]}, '1.1.8': {'key': '1.1.8', 'values': [{'ID': '1.1.8', 'emotion': 'sadness', 'value': 0.147221}, {'ID': '1.1.8', 'emotion': 'joy', 'value': 0.689603}, {'ID': '1.1.8', 'emotion': 'fear', 'value': 0.039797}, {'ID': '1.1.8', 'emotion': 'disgust', 'value': 0.007045}, {'ID': '1.1.8', 'emotion': 'anger', 'value': 0.022785}]}, '1.1.9': {'key': '1.1.9', 'values': [{'ID': '1.1.9', 'emotion': 'sadness', 'value': 0.032423}, {'ID': '1.1.9', 'emotion': 'joy', 'value': 0.595649}, {'ID': '1.1.9', 'emotion': 'fear', 'value': 0.02916}, {'ID': '1.1.9', 'emotion': 'disgust', 'value': 0.014823}, {'ID': '1.1.9', 'emotion': 'anger', 'value': 0.020314}]}, '1.2.10': {'key': '1.2.10', 'values': [{'ID': '1.2.10', 'emotion': 'sadness', 'value': 0.121597}, {'ID': '1.2.10', 'emotion': 'joy', 'value': 0.552586}, {'ID': '1.2.10', 'emotion': 'fear', 'value': 0.054775}, {'ID': '1.2.10', 'emotion': 'disgust', 'value': 0.12608}, {'ID': '1.2.10', 'emotion': 'anger', 'value': 0.179098}]}, '1.1.10': {'key': '1.1.10', 'values': [{'ID': '1.1.10', 'emotion': 'sadness', 'value': 0.062709}, {'ID': '1.1.10', 'emotion': 'joy', 'value': 0.843144}, {'ID': '1.1.10', 'emotion': 'fear', 'value': 0.047503}, {'ID': '1.1.10', 'emotion': 'disgust', 'value': 0.015426}, {'ID': '1.1.10', 'emotion': 'anger', 'value': 0.008202}]}, '1.1.11': {'key': '1.1.11', 'values': [{'ID': '1.1.11', 'emotion': 'sadness', 'value': 0.062709}, {'ID': '1.1.11', 'emotion': 'joy', 'value': 0.843144}, {'ID': '1.1.11', 'emotion': 'fear', 'value': 0.047503}, {'ID': '1.1.11', 'emotion': 'disgust', 'value': 0.015426}, {'ID': '1.1.11', 'emotion': 'anger', 'value': 0.008202}]}, '1.2.12': {'key': '1.2.12', 'values': [{'ID': '1.2.12', 'emotion': 'sadness', 'value': 0.215322}, {'ID': '1.2.12', 'emotion': 'joy', 'value': 0.613089}, {'ID': '1.2.12', 'emotion': 'fear', 'value': 0.193998}, {'ID': '1.2.12', 'emotion': 'disgust', 'value': 0.021328}, {'ID': '1.2.12', 'emotion': 'anger', 'value': 0.01257}]}, '1.1.12': {'key': '1.1.12', 'values': [{'ID': '1.1.12', 'emotion': 'sadness', 'value': 0.499454}, {'ID': '1.1.12', 'emotion': 'joy', 'value': 0.192718}, {'ID': '1.1.12', 'emotion': 'fear', 'value': 0.202}, {'ID': '1.1.12', 'emotion': 'disgust', 'value': 0.046843}, {'ID': '1.1.12', 'emotion': 'anger', 'value': 0.109288}]}, '1.2.13': {'key': '1.2.13', 'values': [{'ID': '1.2.13', 'emotion': 'sadness', 'value': 0.246203}, {'ID': '1.2.13', 'emotion': 'joy', 'value': 0.288084}, {'ID': '1.2.13', 'emotion': 'fear', 'value': 0.104512}, {'ID': '1.2.13', 'emotion': 'disgust', 'value': 0.183487}, {'ID': '1.2.13', 'emotion': 'anger', 'value': 0.058274}]}, '1.1.13': {'key': '1.1.13', 'values': [{'ID': '1.1.13', 'emotion': 'sadness', 'value': 0.174573}, {'ID': '1.1.13', 'emotion': 'joy', 'value': 0.646112}, {'ID': '1.1.13', 'emotion': 'fear', 'value': 0.103068}, {'ID': '1.1.13', 'emotion': 'disgust', 'value': 0.055578}, {'ID': '1.1.13', 'emotion': 'anger', 'value': 0.030469}]}, '1.2.14': {'key': '1.2.14', 'values': [{'ID': '1.2.14', 'emotion': 'sadness', 'value': 0.121597}, {'ID': '1.2.14', 'emotion': 'joy', 'value': 0.552586}, {'ID': '1.2.14', 'emotion': 'fear', 'value': 0.054775}, {'ID': '1.2.14', 'emotion': 'disgust', 'value': 0.12608}, {'ID': '1.2.14', 'emotion': 'anger', 'value': 0.179098}]}, '1.1.14': {'key': '1.1.14', 'values': [{'ID': '1.1.14', 'emotion': 'sadness', 'value': 0.186308}, {'ID': '1.1.14', 'emotion': 'joy', 'value': 0.177555}, {'ID': '1.1.14', 'emotion': 'fear', 'value': 0.105614}, {'ID': '1.1.14', 'emotion': 'disgust', 'value': 0.157869}, {'ID': '1.1.14', 'emotion': 'anger', 'value': 0.101773}]}, '1.1.15': {'key': '1.1.15', 'values': [{'ID': '1.1.15', 'emotion': 'sadness', 'value': 0.186308}, {'ID': '1.1.15', 'emotion': 'joy', 'value': 0.177555}, {'ID': '1.1.15', 'emotion': 'fear', 'value': 0.105614}, {'ID': '1.1.15', 'emotion': 'disgust', 'value': 0.157869}, {'ID': '1.1.15', 'emotion': 'anger', 'value': 0.101773}]}, '1.2.16': {'key': '1.2.16', 'values': [{'ID': '1.2.16', 'emotion': 'sadness', 'value': 0.392709}, {'ID': '1.2.16', 'emotion': 'joy', 'value': 0.285414}, {'ID': '1.2.16', 'emotion': 'fear', 'value': 0.187546}, {'ID': '1.2.16', 'emotion': 'disgust', 'value': 0.221073}, {'ID': '1.2.16', 'emotion': 'anger', 'value': 0.051239}]}, '1.1.16': {'key': '1.1.16', 'values': [{'ID': '1.1.16', 'emotion': 'sadness', 'value': 0.098371}, {'ID': '1.1.16', 'emotion': 'joy', 'value': 0.726226}, {'ID': '1.1.16', 'emotion': 'fear', 'value': 0.03896}, {'ID': '1.1.16', 'emotion': 'disgust', 'value': 0.079797}, {'ID': '1.1.16', 'emotion': 'anger', 'value': 0.021642}]}, '1.2.17': {'key': '1.2.17', 'values': [{'ID': '1.2.17', 'emotion': 'sadness', 'value': 0.226068}, {'ID': '1.2.17', 'emotion': 'joy', 'value': 0.240363}, {'ID': '1.2.17', 'emotion': 'fear', 'value': 0.39252}, {'ID': '1.2.17', 'emotion': 'disgust', 'value': 0.189614}, {'ID': '1.2.17', 'emotion': 'anger', 'value': 0.155086}]}, '1.1.17': {'key': '1.1.17', 'values': [{'ID': '1.1.17', 'emotion': 'sadness', 'value': 0.042433}, {'ID': '1.1.17', 'emotion': 'joy', 'value': 0.845805}, {'ID': '1.1.17', 'emotion': 'fear', 'value': 0.089871}, {'ID': '1.1.17', 'emotion': 'disgust', 'value': 0.011636}, {'ID': '1.1.17', 'emotion': 'anger', 'value': 0.031437}]}, '1.2.18': {'key': '1.2.18', 'values': [{'ID': '1.2.18', 'emotion': 'sadness', 'value': 0.101241}, {'ID': '1.2.18', 'emotion': 'joy', 'value': 0.029988}, {'ID': '1.2.18', 'emotion': 'fear', 'value': 0.832098}, {'ID': '1.2.18', 'emotion': 'disgust', 'value': 0.152221}, {'ID': '1.2.18', 'emotion': 'anger', 'value': 0.065007}]}, '1.1.18': {'key': '1.1.18', 'values': [{'ID': '1.1.18', 'emotion': 'sadness', 'value': 0.032423}, {'ID': '1.1.18', 'emotion': 'joy', 'value': 0.595649}, {'ID': '1.1.18', 'emotion': 'fear', 'value': 0.02916}, {'ID': '1.1.18', 'emotion': 'disgust', 'value': 0.014823}, {'ID': '1.1.18', 'emotion': 'anger', 'value': 0.020314}]}, '1.2.19': {'key': '1.2.19', 'values': [{'ID': '1.2.19', 'emotion': 'sadness', 'value': 0.916667}, {'ID': '1.2.19', 'emotion': 'joy', 'value': 0.0}, {'ID': '1.2.19', 'emotion': 'fear', 'value': 0.931034}, {'ID': '1.2.19', 'emotion': 'disgust', 'value': 0.931034}, {'ID': '1.2.19', 'emotion': 'anger', 'value': 0.931034}]}};


drawAll(data_with_values, id_by_name, node_data);
	
//Initiates practically everything
function drawAll(dataValues, IDbyName, nodeData) {
	var padding = 20,
		width = Math.max($("#chart").innerWidth(),350) - padding,
		<!-- height = window.innerWidth < 768 ? width : (window.innerHeight - 90); -->
		height = 420;

	var centerX = width/2,
		centerY = height/2;

	//Create the visible canvas and context
	var canvas  = d3.select("#chart").append("canvas")
		.attr("id", "canvas")
		.attr("width", width)
		.attr("height", height);
		
	var context = canvas.node().getContext("2d");
		context.clearRect(0, 0, width, height);
	
	//Create a hidden canvas in which each circle will have a different color
	//We can use this to capture the clicked/hovered over on circle
	var hiddenCanvas  = d3.select("#chart").append("canvas")
		.attr("id", "hiddenCanvas")
		.attr("width", width)
		.attr("height", height)
		.style("display","none");
		
	var hiddenContext = hiddenCanvas.node().getContext("2d");
		hiddenContext.clearRect(0, 0, width, height);

	var mainTextColor = [74,74,74],//"#4A4A4A",
		titleFont = "Oswald",
		bodyFont = "Merriweather Sans";
	
	var colorCircle = d3.scale.ordinal()
			.domain([0,1])
			.range(['#f03b20', '#feb24c']);
			
	var colorBar = d3.scale.ordinal()
		.domain(["sadness","joy","fear","disgust","anger"])
		.range(["#EFB605", "#E3690B", "#CF003E", "#991C71", "#4F54A8"]);	

	var diameter = Math.min(width*0.95, height*0.95),
		radius = diameter / 2;
		
	var commaFormat = d3.format(',');
	
	var zoomInfo = {
		centerX: centerX,
		centerY: centerY,
		scale: 1
	};
	
	//Dataset to swtich between color of a circle (in the hidden canvas) and the node data	
	var colToCircle = {};
	
	var pack = d3.layout.pack()
		.padding(1)
		.size([diameter, diameter])
		.value(function(d) { return d.relevance; })
		.sort(function(d) { return d.ID; });

	var nodes = pack.nodes(nodeData),
		root = nodeData,
		focus = root,
		nodeCount = nodes.length;

	var nodeByName = {};
	nodes.forEach(function(d,i) {
		nodeByName[d.name] = d;
	});
		
	var elementsPerBar = 5,
		barChartHeight = 0.7,
		barChartHeightOffset = 0.15;
	
	//The draw function of the canvas that gets called on each frame
	function drawCanvas(chosenContext, hidden) {

		//Clear canvas
		chosenContext.fillStyle = "WHITE";
		chosenContext.rect(0,0,width,height);
		chosenContext.fill();
	  
		//Select our dummy nodes and draw the data to canvas.
		var node = null;
		// It's slightly faster than nodes.forEach()
		for (var i = 0; i < nodeCount; i++) {
			node = nodes[i];

			//If the hidden canvas was send into this function and it does not yet have a color, generate a unique one
			if(hidden) {
				if(node.color == null) {
					// If we have never drawn the node to the hidden canvas get a new color for it and put it in the dictionary.
					node.color = genColor();
					colToCircle[node.color] = node;
				}//if
				// On the hidden canvas each rectangle gets a unique color.
				chosenContext.fillStyle = node.color;
			} else {
				chosenContext.fillStyle = node.children ? colorCircle(node.depth) : "white";
			}//else
	
			var nodeX = ((node.x - zoomInfo.centerX) * zoomInfo.scale) + centerX,
				nodeY = ((node.y - zoomInfo.centerY) * zoomInfo.scale) + centerY,
				nodeR = node.r * zoomInfo.scale;
				
			//Use one node to reset the scale factor for the legend
			if(i === 4) scaleFactor = node.value/(nodeR * nodeR); 
						
			//Draw each circle
			chosenContext.beginPath();
			chosenContext.arc(nodeX, nodeY, nodeR, 0,  2 * Math.PI, true);				
			chosenContext.fill();
		
			//Draw the bars inside the circles (only in the visible canvas)
			//Only draw bars in leaf nodes
			if(node.ID in dataValues) {
				//Only draw the bars that are in the same parent ID as the clicked on node
				if(node.ID.lastIndexOf(currentID, 0) === 0  & !hidden) {
					//if(node.ID === "1.1.1.30") console.log(currentID);
														
					//Variables for the bar title
					var drawTitle = true;
					var fontSizeTitle = Math.round(nodeR / 10);
					if (fontSizeTitle < 8) drawTitle = false;

					//Only draw the title if the font size is big enough
					if(drawTitle & showText) {	
						//First the light grey total text
						chosenContext.font = (fontSizeTitle*0.5 <= 5 ? 0 : Math.round(fontSizeTitle*0.5)) + "px " + bodyFont;
						chosenContext.fillStyle = "rgba(191,191,191," + textAlpha +")" //"#BFBFBF";
						chosenContext.textAlign = "center";
						chosenContext.textBaseline = "middle"; 
						chosenContext.fillText("Total "+commaFormat(node.relevance)+" (in thousands)", nodeX, nodeY + -0.75 * nodeR);
						
						//Get the text back in pieces that will fit inside the node
						var titleText = getLines(chosenContext, node.name, nodeR*2*0.7, fontSizeTitle, titleFont);
						//Loop over all the pieces and draw each line
						titleText.forEach(function(txt, iterator) { 
							chosenContext.font = fontSizeTitle + "px " + titleFont;
							chosenContext.fillStyle = "rgba(" + mainTextColor[0] + "," + mainTextColor[1] + ","+ mainTextColor[2] + "," + textAlpha +")";
							chosenContext.textAlign = "center";
							chosenContext.textBaseline = "middle"; 
							chosenContext.fillText(txt, nodeX, nodeY + (-0.65 + iterator*0.125) * nodeR);
						})//forEach
						
					}//if

					//The barscale differs per node
					var barScale = d3.scale.linear()
						.domain([0, 1]) //max value of bar charts in circle
						.range([0, nodeR]);
			
					//Variables for the bar chart
					var bars = dataValues[node.ID].values;
					var	totalOffset = nodeX + -nodeR*0.3, 
						eachBarHeight = ((1 - barChartHeightOffset) * 2 * nodeR * barChartHeight)/elementsPerBar,
						barHeight = eachBarHeight*0.8;
					
					//Variables for the labels on the bars: Age
					var drawLabelText = true;
					var fontSizeLabels = Math.round(nodeR / 18);
					if (fontSizeLabels < 6) drawLabelText = false;
					
					//Variables for the value labels on the end of each bar
					var drawValueText = true;
					var fontSizeValues = Math.round(nodeR / 22);
					if (fontSizeValues < 6) drawValueText = false;
					
					//Only draw the bars and all labels of each bar has a height of at least 1 pixel
					if (Math.round(barHeight) > 1) {
						//Loop over each bar
						for (var j = 0; j < bars.length; j++) {
							var bar = bars[j];
							
							bar.width = (isNaN(bar.value) ? 0 : barScale(bar.value)); 
							bar.barPiecePosition = nodeY + barChartHeightOffset*2*nodeR + j*eachBarHeight - barChartHeight*nodeR;
							
							//Draw the bar
							chosenContext.beginPath();
							chosenContext.fillStyle = colorBar(bar.emotion);
							chosenContext.fillRect(nodeX + -nodeR*0.3, bar.barPiecePosition, bar.width, barHeight);
							chosenContext.fill();
							
							//Only draw the age labels if the font size is big enough
							if(drawLabelText & showText) {
								chosenContext.font = fontSizeLabels + "px " + bodyFont;
								chosenContext.fillStyle = "rgba(" + mainTextColor[0] + "," + mainTextColor[1] + ","+ mainTextColor[2] + "," + textAlpha +")";
								chosenContext.textAlign = "right";
								chosenContext.textBaseline = "middle"; 
								chosenContext.fillText(bar.emotion, nodeX + -nodeR*0.35, bar.barPiecePosition+0.5*barHeight);
							}//if
							
							//Only draw the value labels if the font size is big enough
							if(drawValueText & showText) {
								chosenContext.font = fontSizeValues + "px " + bodyFont;
								var txt = commaFormat(bar.value);
								//Check to see if the bar is big enough to place the text inside it
								//If not, place the text outside the bar
								var textWidth = chosenContext.measureText(txt).width;
								var valuePos = (textWidth*1.1 > (bar.width - nodeR * 0.03) ? "left" : "right");
								
								//Calculate the x position of the bar value label
								bar.valueLoc = nodeX + -nodeR*0.3 + bar.width + (valuePos === "left" ? (nodeR * 0.03) : (-nodeR * 0.03));
								
								//Draw the text
								chosenContext.fillStyle = (valuePos === "left" ? "rgba(51,51,51," + textAlpha +")" : "rgba(255,255,255," + textAlpha +")"); //#333333 or white
								chosenContext.textAlign = valuePos;
								chosenContext.textBaseline = "middle"; 
								chosenContext.fillText(txt, bar.valueLoc, bar.barPiecePosition+0.5*barHeight);
							}//if
				
						}//for j
					}//if -> Math.round(barHeight) > 1
					
				}//if -> node.ID.lastIndexOf(currentID, 0) === 0 & !hidden
			}//if -> node.ID in dataById 
			
		}//for i
		
		var counter = 0; //Needed for the rotation of the arc titles
		
		//Do a second loop because the arc titles always have to be drawn on top
		for (var i = 0; i < nodeCount; i++) {
			node = nodes[i];
		
			var nodeX = ((node.x - zoomInfo.centerX) * zoomInfo.scale) + centerX,
				nodeY = ((node.y - zoomInfo.centerY) * zoomInfo.scale) + centerY,
				nodeR = node.r * zoomInfo.scale;
			
			//Don't draw for leaf-nodes
			//And don't draw the arced label for the largest outer circle
			//And don't draw these things for the hidden layer
			//And only draw these while showText = true (so not during a zoom)
			//And hide those not close the the parent
			if(typeof node.parent !== "undefined" & typeof node.children !== "undefined") {
				if(node.name !== "outermost" & !hidden & showText & $.inArray(node.name, kids) >= 0) {
					//Calculate the best font size for the non-leaf nodes
					var fontSizeTitle = Math.round(nodeR / 10);
					if (fontSizeTitle > 4) drawCircularText(chosenContext, node.name.replace(/,? and /g, ' & '), fontSizeTitle, titleFont, nodeX, nodeY, nodeR, rotationText[counter], 0);
				}//if
				counter = counter + 1;
			}//if

		}//for i
		
	}//function drawCanvas
	
	//Default values for variables - set to root
	var currentID = "",
		oldID = "",
		kids = ["outermost"]; //needed to check which arced titles to show - only those close to the parent node
	
	//Setup the kids variable for the top (root) level			
	for(var i = 0; i < root.children.length; i++) { kids.push(root.children[i].name) };	
	
	//Function to run oif a user clicks on the canvas
	var clickFunction = function(e){
		//Figure out where the mouse click occurred.
		var mouseX = e.offsetX; //e.layerX;
		var mouseY = e.offsetY; //e.layerY;

		// Get the corresponding pixel color on the hidden canvas and look up the node in our map.
		// This will return that pixel's color
		var col = hiddenContext.getImageData(mouseX, mouseY, 1, 1).data;
		//Our map uses these rgb strings as keys to nodes.
		var colString = "rgb(" + col[0] + "," + col[1] + ","+ col[2] + ")";
		var node = colToCircle[colString];

		//If there was an actual node clicked on, zoom into this
		if(node) {
			//If the same node is clicked twice, set it to the top (root) level
			if (focus === node) node = root;
			
			//Save the names of the circle itself and first children
			//Needed to check which arc titles to show
			kids = [node.name];
			if(typeof node.children !== "undefined") {
				for(var i = 0; i < node.children.length; i++) {
					kids.push(node.children[i].name)
				}//for i
			}//if
 
			//Perform the zoom
			zoomToCanvas(node);			
		}//if -> node
		
	}//function clickFunction

	//Listen for clicks on the main canvas
	//document.getElementById("canvas").addEventListener("click", clickFunction);
	$("#canvas").on("click", clickFunction);
	
	//Only run this if the user actually has a mouse
	if (true) {
		var nodeOld = root;
		
		//Listen for mouse moves on the main canvas
		var mousemoveFunction = function(e){
			//Figure out where the mouse click occurred.
			var mouseX = e.offsetX; //e.layerX;
			var mouseY = e.offsetY; //e.layerY;
			
			// Get the corresponding pixel color on the hidden canvas and look up the node in our map.
			// This will return that pixel's color
			var col = hiddenContext.getImageData(mouseX, mouseY, 1, 1).data;
			//Our map uses these rgb strings as keys to nodes.
			var colString = "rgb(" + col[0] + "," + col[1] + ","+ col[2] + ")";
			var node = colToCircle[colString];

			//Only change the popover if the user mouses over something new
			if(node !== nodeOld) {
				//Remove all previous popovers
				$('.popoverWrapper').remove(); 
				$('.popover').each(function() {
						$('.popover').remove(); 	
				 }); 
				//Only continue when the user mouses over an actual node
				if(node) {
					//Only show a popover for the leaf nodes
					if(typeof node.ID !== "undefined") {
						//Needed for placement
						var nodeX = ((node.x - zoomInfo.centerX) * zoomInfo.scale) + centerX,
							nodeY = ((node.y - zoomInfo.centerY) * zoomInfo.scale) + centerY,
							nodeR = node.r * zoomInfo.scale;
						
						//Create the wrapper div for the popover
						var div = document.createElement('div');
						div.setAttribute('class', 'popoverWrapper');
						document.getElementById('chart').appendChild(div);

						//Position the wrapper right above the circle
						$(".popoverWrapper").css({
							'position':'absolute',
							'top':nodeY-nodeR,
							'left':nodeX+padding*5/4
						});
						
						//Show the tooltip
						$(".popoverWrapper").popover({
							placement: 'auto top',
							container: 'body',
							trigger: 'manual',
							html : true,
							animation:false,
							content: function() { 
								return "<span class='nodeTooltip'>" + node.name + "</span>"; }
							});
						$(".popoverWrapper").popover('show');
					}//if -> typeof node.ID !== "undefined"
				}//if -> node
			}//if -> node !== nodeOld
			
			nodeOld = node;
		}//function mousemoveFunction
		
		//document.getElementById("canvas").addEventListener("mousemove", mousemoveFunction);
		$("#canvas").on("mousemove", mousemoveFunction);
	
	}//if !mobileSize

	
	//Based on the generous help by Stephan Smola
	//http://bl.ocks.org/smoli/d7e4f9199c15d71258b5
	
	var ease = d3.ease("cubic-in-out"),
		timeElapsed = 0,
		interpolator = null,
		duration = 1500, //Starting duration
		vOld = [focus.x, focus.y, focus.r * 2.05];
	
	//Create the interpolation function between current view and the clicked on node
	function zoomToCanvas(focusNode) {
		
		//Temporarily disable click & mouseover events
		$("#canvas").css("pointer-events", "none");
	
		//Remove all previous popovers - if present
		$('.popoverWrapper').remove(); 
		$('.popover').each(function() {
				$('.popover').remove(); 	
		}); 
					
		//Save the ID of the clicked on node (or its parent, if it is a leaf node)
		//Only the nodes close to the currentID will have bar charts drawn
		if (focusNode === focus) currentID = ""; 
		else currentID = (typeof focusNode.ID === "undefined" ? IDbyName[focusNode.name] : focusNode.ID.replace(/\.([^\.]*)$/, ""));
		
		//Set the new focus
		focus = focusNode;
		var v = [focus.x, focus.y, focus.r * 2.05]; //The center and width of the new "viewport"

		//Create interpolation between current and new "viewport"
		interpolator = d3.interpolateZoom(vOld, v);
			
		//Set the needed "zoom" variables
		duration = 	Math.max(1500, interpolator.duration); //Interpolation gives back a suggested duration	 		
		timeElapsed = 0; //Set the time elapsed for the interpolateZoom function to 0	
		showText = false; //Don't show text during the zoom
		vOld = v; //Save the "viewport" of the next state as the next "old" state
		
		//Only show the circle legend when not at a leaf node
		if(typeof focusNode.children === "undefined") {
			d3.select("#legendRowWrapper").style("opacity", 0);
			d3.select(".legendWrapper").transition().duration(1000).style("opacity", 0);
		} else {
			d3.select("#legendRowWrapper").style("opacity", 1);
			d3.select(".legendWrapper").transition().duration(1000).delay(duration).style("opacity", 1);
		}//else
		
		//Start animation
		stopTimer = false;
		animate();
		
	}//function zoomToCanvas
	
	//Perform the interpolation and continuously change the zoomInfo while the "transition" occurs
	function interpolateZoom(dt) {
		if (interpolator) {
			timeElapsed += dt;
			var t = ease(timeElapsed / duration); //mini interpolator that puts 0 - duration into 0 - 1 in a cubic-in-out fashion
			
			//Set the new zoom variables
			zoomInfo.centerX = interpolator(t)[0];
			zoomInfo.centerY = interpolator(t)[1];
			zoomInfo.scale = diameter / interpolator(t)[2];
		
			//After iteration is done remove the interpolater and set the fade text back into motion
			if (timeElapsed >= duration) {
				interpolator = null;
				showText = true;
				fadeText = true;
				timeElapsed = 0;
				
				//Draw the hidden canvas again, now that everything is settled in 
				//to make sure it is in the same state as the visible canvas
				//This way the tooltip and click work correctly
				drawCanvas(hiddenContext, true);
				
				//Update the texts in the legend
				d3.select(".legendWrapper").selectAll(".legendText")
					.text(function(d) { return commaFormat(Math.round(scaleFactor * d * d / 10)*10); });
				
			}//if -> timeElapsed >= duration
		}//if -> interpolator
	}//function zoomToCanvas

	//Text fading variables
	var	showText = true, //Only show the text while you're not zooming
		textAlpha = 1, //After a zoom is finished fade in the text;
		fadeText = false,
		fadeTextDuration = 750;
	//Function that fades in the text - Otherwise the text will be jittery during the zooming	
	function interpolateFadeText(dt) {
		if(fadeText) {
			timeElapsed += dt;
			textAlpha = ease(timeElapsed / fadeTextDuration);				
			if (timeElapsed >= fadeTextDuration) {
				//Enable click & mouseover events again
				$("#canvas").css("pointer-events", "auto");
				
				fadeText = false; //Jump from loop after fade in is done
				stopTimer = true; //After the fade is done, stop with the redraws / animation
			}//if
		}//if
	}//function interpolateFadeText
	
	//The start angle in degrees for each of the non-node leaf titles
	var rotationText = [-14,4,23,-18,-10.5,-20,20,20,46,-30,-25,-20,20,15,-30,-15,-45,12,-15,-16,15,15,5,18,5,15,20,-20,-25]; //The rotation of each arc text
	
	//Adjusted from: http://blog.graphicsgen.com/2015/03/html5-canvas-rounded-text.html
	function drawCircularText(ctx, text, fontSize, titleFont, centerX, centerY, radius, startAngle, kerning) {
		// startAngle:   In degrees, Where the text will be shown. 0 degrees if the top of the circle
		// kearning:     0 for normal gap between letters. Positive or negative number to expand/compact gap in pixels
				
		//Setup letters and positioning
		ctx.textBaseline = 'alphabetic';
		ctx.textAlign = 'center'; // Ensure we draw in exact center
		ctx.font = fontSize + "px " + titleFont;
		ctx.fillStyle = "rgba(255,255,255," + textAlpha +")";

		startAngle = startAngle * (Math.PI / 180); // convert to radians
		text = text.split("").reverse().join(""); // Reverse letters
		
		//Rotate 50% of total angle for center alignment
		for (var j = 0; j < text.length; j++) {
			var charWid = ctx.measureText(text[j]).width;
			startAngle += ((charWid + (j == text.length-1 ? 0 : kerning)) / radius) / 2;
		}//for j

		ctx.save(); //Save the default state before doing any transformations
		ctx.translate(centerX, centerY); // Move to center
		ctx.rotate(startAngle); //Rotate into final start position
			
		//Now for the fun bit: draw, rotate, and repeat
		for (var j = 0; j < text.length; j++) {
			var charWid = ctx.measureText(text[j]).width/2; // half letter
			//Rotate half letter
			ctx.rotate(-charWid/radius); 
			//Draw the character at "top" or "bottom" depending on inward or outward facing
			ctx.fillText(text[j], 0, -radius);
			//Rotate half letter
			ctx.rotate(-(charWid + kerning) / radius); 
		}//for j
		
		ctx.restore(); //Restore to state as it was before transformations
	}//function drawCircularText

	////////////////////////////////////////////////////////////// 
	///////////////////// Create Search Box ////////////////////// 
	////////////////////////////////////////////////////////////// 

	//Create options - all the occupations
	var options = nodes.map(function(d) { return d.name; });
	
	var select = document.getElementById("searchBox"); 
	var select = document.getElementById("searchBox"); 
	//Put new options into select box
	for(var i = 0; i < options.length; i++) {
		var opt = options[i];
		var el = document.createElement("option");
		el.textContent = opt;
		el.value = opt;
		select.appendChild(el);
	}

	//Create search combo box
	<!-- $('.combobox').Combobox(); -->
	
	//Function to call once the search box is filled in
	searchEvent = function(occupation) { 
		//If the occupation is not equal to the default
		if (occupation !== "" & typeof occupation !== "undefined") {
			zoomToCanvas(nodeByName[occupation]);
		}//if 
	}//searchEvent
		
	
	////////////////////////////////////////////////////////////// 
	/////////////////////// Initiate ///////////////////////////// 
	////////////////////////////////////////////////////////////// 
			
	//First zoom to get the circles to the right location
	zoomToCanvas(root);
	//Draw the hidden canvas at least once
	drawCanvas(hiddenContext, true);
	//Draw the legend
	var scaleFactor = 1; //dummy value
	createLegend(scaleFactor);
	//Slowly fade in so the scaleFactor is set to the correct value in the mean time :)
	d3.select(".legendWrapper").transition().duration(1000).delay(500).style("opacity", 1);
	
	//Start the drawing loop. It will jump out of the loop once stopTimer becomes true
	var stopTimer = false;
	animate();
	
	//This function runs during changes in the visual - during a zoom
	function animate() {
		var dt = 0;
		d3.timer(function(elapsed) {
			interpolateZoom(elapsed - dt);
			interpolateFadeText(elapsed - dt);
			dt = elapsed;
			drawCanvas(context);

			return stopTimer;
		});
	}//function animate
		
}//drawAll

	
////////////////////////////////////////////////////////////// 
//////////////////// Other Functions /////////////////////////
////////////////////////////////////////////////////////////// 

//Needed in the global scope
var searchEvent = function(occupation) { };
	
//If there is a scroll bar then its fine
//But if there is no scrollbar prevent one from occuring when the user opens the search box
//Otherwise the visual will seem to move to the left for a bit and that looks rather odd
var noScrollBar = ($(document).height() > $(window).height() ? false : true);
if(noScrollBar) {
	//Prevent scroll bars from forming
	document.documentElement.style.overflow = 'hidden';  // firefox, chrome
	document.body.scroll = "no"; // ie only
}//if

//Generates the next color in the sequence, going from 0,0,0 to 255,255,255.
//From: https://bocoup.com/weblog/2d-picking-in-canvas
var nextCol = 1;
function genColor(){
	var ret = [];
	// via http://stackoverflow.com/a/15804183
	if(nextCol < 16777215){
	  ret.push(nextCol & 0xff); // R
	  ret.push((nextCol & 0xff00) >> 8); // G 
	  ret.push((nextCol & 0xff0000) >> 16); // B

	  nextCol += 100; // This is exagerated for this example and would ordinarily be 1.
	}
	var col = "rgb(" + ret.join(',') + ")";
	return col;
}//function genColor

//From http://stackoverflow.com/questions/2936112/text-wrap-in-a-canvas-element
function getLines(ctx, text, maxWidth, fontSize, titleFont) {
	var words = text.split(" ");
	var lines = [];
	var currentLine = words[0];

	for (var i = 1; i < words.length; i++) {
		var word = words[i];
		ctx.font = fontSize + "px " + titleFont;
		var width = ctx.measureText(currentLine + " " + word).width;
		if (width < maxWidth) {
			currentLine += " " + word;
		} else {
			lines.push(currentLine);
			currentLine = word;
		}
	}
	lines.push(currentLine);
	return lines;
}//function getLines

////////////////////////////////////////////////////////////// 
///////////// Function | The legend creation /////////////////
////////////////////////////////////////////////////////////// 

function createLegend(scaleFactor) {
	var legendSizes = [10,20,30],
		commaFormat = d3.format(',');
		
	//d3.select("#legendRowWrapper").style("opacity", 0);
	
	var width = $("#legendCircles").width(),
		height = legendSizes[2]*2*1.2;

	var	legendCenter = -10,
		legendBottom = height,
		legendLineLength = legendSizes[2]*1.3,
		textPadding = 5
		
	//Create SVG for the legend
	var svg = d3.select("#legendCircles").append("svg")
		.attr("width", width)
		.attr("height", height)
	  .append("g")
		.attr("class", "legendWrapper")
		.attr("transform", "translate(" + width / 2 + "," + 0 + ")")
		.style("opacity", 0);
	
	//Draw the circles
	svg.selectAll(".legendCircle")
		.data(legendSizes)
		.enter().append("circle")
		.attr('r', function(d) { return d; })
		.attr('class',"legendCircle")
		.attr('cx', legendCenter)
		.attr('cy', function(d) { return legendBottom-d; });
	//Draw the line connecting the top of the circle to the number
	svg.selectAll(".legendLine")
		.data(legendSizes)
		.enter().append("line")
		.attr('class',"legendLine")
		.attr('x1', legendCenter)
		.attr('y1', function(d) { return legendBottom-2*d; })
		.attr('x2', legendCenter + legendLineLength)
		.attr('y2', function(d) { return legendBottom-2*d; });	
	//Place the value next to the line
	svg.selectAll(".legendText")
		.data(legendSizes)
		.enter().append("text")
		.attr('class',"legendText")
		.attr('x', legendCenter + legendLineLength + textPadding)
		.attr('y', function(d) { return legendBottom-2*d; })
		.attr('dy', '0.3em')
		.text(function(d) { return commaFormat(Math.round(scaleFactor * d * d / 10)*10); });
		
}//createLegend
</script>

    </div>

	<div class="index_page">
	
	</div>
	
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../static/js/vendor/jquery-1.11.2.min.js"><\/script>')</script>

    <script src="../static/js/vendor/bootstrap.min.js"></script>

    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/main.js"></script>

</body>
</html>